<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Capability-based OS | </title> <meta name="author" content="You Wu"> <meta name="description" content="Extension of the capability-based operating system - Barrelfish OS."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?5e7b374fe50186ca9d1f4a9d6722c92c"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://youwuyou.github.io/projects/project_aos_barrelfish/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">HOME</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">BLOG</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">PROJECTS</a> </li> <li class="nav-item "> <a class="nav-link" href="/summaries/">SUMMARIES</a> </li> <li class="nav-item "> <a class="nav-link" href="/activities/">HPC TEAM</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">üíª</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/cv/">CV</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/repositories/">REPOSITORIES</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/news/">NEWS</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Capability-based OS</h1> <p class="post-description">Extension of the capability-based operating system - Barrelfish OS.</p> </header> <article> <hr> <p>Modern hardware features pose various challenges for designing and implementing modern operating systems, in the course <a href="https://systems.ethz.ch/education/courses/2024-spring/advanced-operating-systems-.html" rel="external nofollow noopener" target="_blank">‚ÄúAdvanced Operating System‚Äù 263-3800-00L</a> we explored different aspects of operating system development. This was a course I took during my final semester FS2024 of undergraduate studies at ETH Z√ºrich, and it was entirely graded based on practical implementation work in C and assembly language and a final project report.</p> <p>In my opinion, this course was incredibly interesting. Having a good understanding of the book ‚ÄúComputer Systems: A Programmer‚Äôs Perspective‚Äù by Bryant and O‚ÄôHallaron should suffice to provide you a good start.</p> <div style="height: 20px;"></div> <h2 id="roadmap-for-building-the-essence-of-an-os">Roadmap for Building the Essence of an OS</h2> <div class="alert alert-info"> <strong>Disclaimer:</strong> The project work described on this page was conducted in a group of five individuals. We had a lot of freedom coming up with various design decisions and evaluating them in different scenarios. Due to the course organizer's requirements, the code cannot be publicly shared. Only a small fraction of images/figures that were created by me (Wu, You) for our final report, which ended up being 130 pages, are shown here for illustrative purposes. </div> <p>In monolithic kernels, like Linux, the kernel handles the virtual and physical memory.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/kernel_comparison.png" style="width: 50%;"> <figcaption>Comparison of monolithic kernel and microkernel operating systems</figcaption> </figure> </center> <p>In Barrelfish, <strong>memory management</strong> is moved from the kernel to the user space. This means that processes handle their own virtual address space and page faults triggered by themselves. In order to ensure correct access control, Barrelfish uses capabilities to track resources and guarantee only allowed access. A capability refers to, in the case of memory management, a specific area of memory and allows the holder of it to manipulate the region of memory described by it. We begin our journey by implementing a memory manager responsible for distributing random access memory (RAM) to the initial process. It needs to track what is free and what is allocated in the physical address space, while performing the necessary capability operations.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/vm_translation.png" style="width: 50%;"> <figcaption>Address translation</figcaption> </figure> </center> <p>For the management of the <strong>virtual memory</strong> and page fault handling in user space, we back up all the memory mappings during the address translation with a multi-level page table, and additionally, we implement a resource manager to keep track of the memory usage of the virtual address space.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/page_table_lookup.png" style="width: 70%;"> <figcaption>Translation of a virtual page to a physical page using the 4-level page table</figcaption> </figure> </center> <p>Next, the focus shifts to <strong>spawning new processes</strong>. This involves initializing new processes, registering them with the Barrelfish CPU driver, and implementing a process manager. The process manager acts as a server process to manage and manipulate these newly spawned processes.</p> <p>As multiple processes run simultaneously, facilitating communication between them becomes essential. A protocol is designed using existing kernel infrastructure to establish channels for <strong>lightweight message-passing (LMP)</strong> between processes.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/lmp_init_resources.png" style="width: 50%;"> <figcaption>Client process requesting various services from the server process named "init" through LMP</figcaption> </figure> </center> <p>Up until this point, the system ran on a single core. While threads can create the illusion of concurrency, true parallelism requires utilizing multiple cores. To enable <strong>multicore</strong> usage on the Toradex board used in this project, we boot a second core, establish communication between bootstrap core and it, and allocate RAM resources to processes in this new multicore environment.</p> <p>Finally, the communication system is refined and unified with <strong>user-level message passing (UMP)</strong> for inter-core communication.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/proc_crosscore.png" style="width: 50%;"> <figcaption>UMP for inter-core communication</figcaption> </figure> </center> <p>We also refined our previous design and provide a more generic and versatile RPC interface for our multicore system in which we design a new data payload format, allowing our RPC user interface to be communication-protocol-agnostic from the user‚Äôs perspective. We also ensured our design is thread-safe, having the concurrency issues in mind.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/rpc_payload.png" style="width: 50%;"> <figcaption>Generic payload design used for message sending in RPC</figcaption> </figure> </center> <div style="height: 20px;"></div> <h2 id="providing-distributed-nameservice">Providing Distributed Nameservice</h2> <p>Building on the group work described above, the course concludes with an individual project where I was responsible for implementing the nameservice. This involved developing distributed nameservers in our multicore system, allowing server processes to register multiple services and enabling client processes to efficiently look up and establish communication channels.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/RPC_client_server.png" style="width: 50%;"> <figcaption>Client-server model as the conceptual foundation of our RPC protocol for process communication</figcaption> </figure> </center> <p>The main task of a nameserver is to maintain a nameserver-side lookup table (LUT) for the key-value lookup. Every value pair contains a name that should convey certain naming convention, and an opaque pointer to the server handle for the registered name. The server handle is used to refer back to the server process that provides the particular service, and it should comply with the server handle of the RPC interface for consistency.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/nameserver_lut.png" style="width: 35%;"> <figcaption>A diagram showing the nameserver-side LUT</figcaption> </figure> </center> <p>There is also a server-side LUT, which is distinct from the nameserver-side LUT. A server process possesses a server-side LUT that is used for the lookup of the pointer to the server handler function, given a service name. The idea of maintaining a server-side LUT meets the need to enable a single process to provide multiple services.</p> <p>As an <strong>outcome</strong>, we were able to request various different services across cores and we also integrated this functionality into our shell, providing convenient commands for requesting and listing available services.</p> <center> <figure> <img src="../../assets/img/projects/aos_project/server_luts.png" style="width: 50%;"> <figcaption>Conceptual illustration of the bookkeeping status of some example processes across two cores.</figcaption> </figure> </center> <center> <figure> <img src="../../assets/img/projects/aos_project/nameservice_using_oncore.png" style="width: 80%;"> <figcaption>Using the shell implemented by @Berke-Ates to perform nameservice tests</figcaption> </figure> </center> <div style="height: 20px;"></div> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2009</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 preview"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/publication_preview/Barrelfish_logo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/publication_preview/Barrelfish_logo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/publication_preview/Barrelfish_logo-1400.webp"></source> <img src="/assets/img/publication_preview/Barrelfish_logo.png" class="preview z-depth-1 rounded" width="auto" height="auto" alt="Barrelfish_logo.png" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div id="Baumann2009TheSystems" class="col-sm-8"> <div class="title">The multikernel: a new OS architecture for scalable multicore systems</div> <div class="author"> Andrew Baumann,¬†Paul Barham,¬†Pierre-Evariste Dagand, and <span class="more-authors" title="click to view 6 more authors" onclick=" var element=$(this); element.attr('title', ''); var more_authors_text=element.text() == '6 more authors' ? 'Tim Harris, Rebecca Isaacs, Simon Peter, Timothy Roscoe, Adrian Sch√ºpbach, Akhilesh Singhania' : '6 more authors'; var cursorPosition=0; var textAdder=setInterval(function(){ element.text(more_authors_text.substring(0, cursorPosition + 1)); if (++cursorPosition == more_authors_text.length){ clearInterval(textAdder); } }, '10'); ">6 more authors</span> </div> <div class="periodical"> <em>In Proceedings of the ACM SIGOPS 22nd Symposium on Operating Systems Principles</em>, 2009 </div> <div class="periodical"> </div> <div class="links"> </div> </div> </div> </li></ol> </div> <div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"youwuyou/youwuyou.github.io","data-repo-id":"R_kgDOKyzLtg","data-category":"Comments","data-category-id":"DIC_kwDOKyzLts4CcQZ8","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> ¬© Copyright 2024 You Wu. Last updated: November 17, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>